name: Auto Update Submodule in Websites-1

on:
  push:
    branches:
      - main  # or your plugin's main branch

jobs:
  update-websites:
    runs-on: ubuntu-latest
    steps:
      - name: Set up Git
        run: |
          git config --global user.name "Sagar Savani"
          git config --global user.email "sagar.savani@multidots.com"

      - name: Read deploy sites from .sites-to-deploy file
        id: read_sites
        run: |
          echo "Reading .sites-to-deploy..."
          SITES=$(cat .sites-to-deploy | tr '\n' ' ')
          echo "SITES=$SITES" >> $GITHUB_ENV

      - name: Update selected site repos
        run: |
          for site in $SITES; do
            echo "Updating $site..."
            git clone --recurse-submodules https://x-access-token:${{ secrets.PERSONAL_ACCESS_TOKEN }}@github.com/sagar-savani-md/$site.git
            cd $site
            cd wp-content/plugins/common-plugin
            git checkout main
            git pull origin main
            cd ../../..
            git add wp-content/plugins/common-plugin
            git commit -m "Auto-update common plugin submodule"
            git push origin main
          done
